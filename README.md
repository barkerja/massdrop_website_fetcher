### Massdrop Website Fetcher

A simple RESTful service that takes in a URL retrieving and storing its content. The service tracks state (processing, failed, success) and will retry in certain fail cases (ex: a site timeout). 

##### Dependencies
- NSQ (http://nsq.io) — A very lightweight decentralized message queue.
- RethinkDB (http://rethinkdb.com/) — A document-based database that easily horizontally scales.
- Docker (https://docker.com) — An engine for running linux containers.

##### Install
The easiest way to run the service is to pull down the docker image and run the binary.

1. `docker pull quay.io/barkerja/massdrop_website_fetcher`
2. `docker run -p 5000:5000 massdrop_website_fetcher`

If you want to build and run the image locally

1. Clone this repository `git clone https://github.com/barkerja/massdrop_website_fetcher.git`
2. `docker build -t massdrop_website_fetcher .`
3. `docker run -p 5000:5000 massdrop_website_fetcher`

##### Example
The endpoints for use are:

##### POST /
 Required Params: `url`
 
 Example:
 
 ```
 curl -X POST -d 'url=massdrop.com' http://192.168.99.100:5000
 ```
 
 Response:
 
 ```
 {
    "created_at": "2015-11-16 16:22:32 +0000",
    "id": "6e5e62f9-8197-4c90-a30d-a8f597acce36",
    "status": "processing",
    "updated_at": "2015-11-16 16:01:30 +0000",
    "url": "massdrop.com"
  }
  ```
  
##### GET /:id

Example:

```
curl http://192.168.99.100:5000/6e5e62f9-8197-4c90-a30d-a8f597acce36
```

Response:

```
{
  "created_at": "2015-11-16 16:22:32 +0000",
  "id": "6e5e62f9-8197-4c90-a30d-a8f597acce36",
  "response": "<!DOCTYPE html><html><head data-prefix=\"og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# massdrop: http://ogp.me/ns/fb/massdrop#\"><script type=\"text/javascript\">var _rollbarConfig = {accessToken: \"0c49fe295d4f48c49e523e4ec07fc5b4\", captureUncaught: true, payload: {environment: \"production\"}};!function(r){function t(o){if(e[o])return e[o].exports;var n=e[o]={exports:{},id:o,loaded:!1};return r[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var e={};return t.m=r,t.c=e,t.p=\"\",t(0)}([function(r,t,e){\"use strict\";var o=e(1).Rollbar,n=e(2),a=\"https://d37gvrvc0wt4s1.cloudfront.net/js/v1.4/rollbar.min.js\";_rollbarConfig.rollbarJsUrl=_rollbarConfig.rollbarJsUrl||a;var i=o.init(window,_rollbarConfig),l=n(i,_rollbarConfig);i.loadFull(window,document,!1,_rollbarConfig,l)},function(r,t){\"use strict\";function e(){var r=window.console;r&&\"function\"==typeof r.log&&r.log.apply(r,arguments)}function o(r){this.shimId=++u,this.notifier=null,this.parentShim=r,this.logger=e,this._rollbarOldOnError=null}function n(r,t,e){window._rollbarWrappedError&&(e[4]||(e[4]=window._rollbarWrappedError),e[5]||(e[5]=window._rollbarWrappedError._rollbarContext),window._rollbarWrappedError=null),r.uncaughtError.apply(r,e),t&&t.apply(window,e)}function a(r){var t=o;return l(function(){if(this.notifier)return this.notifier[r].apply(this.notifier,arguments);var e=this,o=\"scope\"===r;o&&(e=new t(this));var n=Array.prototype.slice.call(arguments,0),a={shim:e,method:r,args:n,ts:new Date};return window._rollbarShimQueue.push(a),o?e:void 0})}function i(r,t){if(t.hasOwnProperty&&t.hasOwnProperty(\"addEventListener\")){var e=t.addEventListener;t.addEventListener=function(t,o,n){e.call(this,t,r.wrap(o),n)};var o=t.removeEventListener;t.removeEventListener=function(r,t,e){o.call(this,r,t&&t._wrapped?t._wrapped:t,e)}}}function l(r,t){return t=t||e,function(){try{return r.apply(this,arguments)}catch(e){t(\"Rollbar internal error:\",e)}}}var u=0;o.init=function(r,t){var e=t.globalAlias||\"Rollbar\";if(\"object\"==typeof r[e])return r[e];r._rollbarShimQueue=[],r._rollbarWrappedError=null,t=t||{};var a=new o;return l(function(){if(a.configure(t),t.captureUncaught){a._rollbarOldOnError=r.onerror,r.onerror=function(){var r=Array.prototype.slice.call(arguments,0);n(a,a._rollbarOldOnError,r)};var o,l,u=\"EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload\".split(\",\");for(o=0;o<u.length;++o)l=u[o],r[l]&&r[l].prototype&&i(a,r[l].prototype)}return r[e]=a,a},a.logger)()},o.prototype.loadFull=function(r,t,e,o,n){var a=l(function(){var r=t.createElement(\"script\"),n=t.getElementsByTagName(\"script\")[0];r.src=o.rollbarJsUrl,r.async=!e,r.onload=i,n.parentNode.insertBefore(r,n)},this.logger),i=l(function(){var t;if(void 0===r._rollbarPayloadQueue){var e,o,a,i;for(t=new Error(\"rollbar.js did not load\");e=r._rollbarShimQueue.shift();)for(a=e.args,i=0;i<a.length;++i)if(o=a[i],\"function\"==typeof o){o(t);break}}\"function\"==typeof n&&n(t)},this.logger);l(function(){e?a():r.addEventListener?r.addEventListener(\"load\",a,!1):r.attachEvent(\"onload\",a)},this.logger)()},o.prototype.wrap=function(r,t){try{var e;if(e=\"function\"==typeof t?t:function(){return t||{}},\"function\"!=typeof r)return r;if(r._isWrap)return r;if(!r._wrapped){r._wrapped=function(){try{return r.apply(this,arguments)}catch(t){throw t._rollbarContext=e()||{},t._rollbarContext._wrappedSource=r.toString(),window._rollbarWrappedError=t,t}},r._wrapped._isWrap=!0;for(var o in r)r.hasOwnProperty(o)&&(r._wrapped[o]=r[o])}return r._wrapped}catch(n){return r}};for(var s=\"log,debug,info,warn,warning,error,critical,global,configure,scope,uncaughtError\".split(\",\"),p=0;p<s.length;++p)o.prototype[s[p]]=a(s[p]);r.exports={Rollbar:o,_rollbarWindowOnError:n}},function(r,t){\"use strict\";r.exports=function(r,t){return function(e){if(!e&&!window._rollbarInitialized){var o=window.RollbarNotifier,n=t||{},a=n.globalAlias||\"Rollbar\",i=window.Rollbar.init(n,r);i._processShimQueue(window._rollbarShimQueue||[]),window[a]=i,window._rollbarInitialized=!0,o.processPayloads()}}}}]);</script><meta charset=\"utf-8\"><meta content=\"IE=edge,chrome=1\" http-equiv=\"X-UA-Compatible\"><meta content=\"on\"><meta content=\"no-store\"><link rel=\"dns-prefetch\" href=\"//cdn1.massdrop.com\"><link rel=\"dns-prefetch\" href=\"//massdrop-s3.imgix.net\"><link rel=\"dns-prefetch\" href=\"//connect.facebook.net\"><meta name=\"robots\" content=\"noodp\"><meta name=\"description\" content=\"Massdrop is an online community for enthusiasts. Whether you&#x27;re an audiophile, quilter, backpacker, or style maven, you can connect with others, discuss your interests and favorite products, and save on those products when you buy together.\"><meta name=\"keywords\" content=\"enthusiast,enthusiasts,audiophile,quilter,backpacker,group buys,price saving,save,money,products,bulk,buying,saving,massdrop,social,discount,drops\"><meta name=\"sailthru.image.full\" content=\"https://massdrop-s3.imgix.net/img_site/favicon/wordmark.png\"><meta name=\"google-site-verification\" content=\"JcyU0HWuT4zex9IMzaqPiQVUK0iUQaGfrv1jFRTkj_U\"><meta property=\"fb:app_id\" content=\"142386762546138\"><meta property=\"og:title\" content=\"Massdrop: Bringing Enthusiasts Together\"><meta property=\"og:site_name\" content=\"Massdrop\"><meta property=\"og:url\" content=\"https://www.massdrop.com/\"><meta property=\"og:type\" content=\"article\"><meta property=\"og:image\" content=\"https://massdrop-s3.imgix.net/img_site/favicon/wordmark.png\"><meta property=\"og:image:secure_url\" content=\"https://massdrop-s3.imgix.net/img_site/favicon/wordmark.png\"><meta property=\"og:description\" content=\"Massdrop is an online community for enthusiasts. Whether you&#x27;re an audiophile, quilter, backpacker, or style maven, you can connect with others, discuss your interests and favorite products, and save on those products when you buy together.\"><meta name=\"twitter:card\" content=\"summary\"><meta name=\"twitter:site\" content=\"@Massdrop\"><meta name=\"twitter:title\" content=\"Massdrop: Bringing Enthusiasts Together\"><meta name=\"twitter:description\" content=\"Massdrop is an online community for enthusiasts. Whether you&#x27;re an audiophile, quilter, backpacker, or style maven, you can connect with others, discuss your interests and favorite products, and save on those products when you buy together.\"><meta name=\"twitter:image:src\" content=\"https://massdrop-s3.imgix.net/img_site/favicon/wordmark.png\"><link rel=\"canonical\" href=\"https://www.massdrop.com/\"><title>Sign Up or Login - Massdrop</title><meta name=\"viewport\" content=\"width=device-width\"><link rel=\"stylesheet\" href=\"https://cdn1.massdrop.com/dist/stylesheets/massdrop-09c483ae156a81cb37ced6f9c6a1b0cf-compressed.css\" media=\"screen\"><link rel=\"stylesheet\" href=\"https://cdn1.massdrop.com/dist/stylesheets/massdrop_print-3f85d78b50bc2c5aa3a877b278cacc95-compressed.css\" media=\"print\"><link rel=\"apple-touch-icon\" href=\"https://massdrop-s3.imgix.net/img_site/favicon/apple-touch-icon-180x180.png?auto=format&amp;fit=crop\"></head><body><div id=\"app\" class=\"massdrop\"></div></body><script>window.App={\"context\":{\"dispatcher\":{\"stores\":{\"CategoriesStore\":{\"categories\":[{\"id\":1,\"communityUrl\":\"audiophile\",\"name\":\"Audiophile\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":\"Audiophile\",\"driveCreativeFolderId\":null},{\"id\":3,\"communityUrl\":\"everyday-carry\",\"name\":\"Everyday Carry\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":\"Everyday Carry\",\"driveCreativeFolderId\":null},{\"id\":4,\"communityUrl\":\"mens-style\",\"name\":\"Men's Style\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":\"Men's Style\",\"driveCreativeFolderId\":null},{\"id\":5,\"communityUrl\":null,\"name\":\"Coffee & Tea\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":6,\"communityUrl\":null,\"name\":\"Auto\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":7,\"communityUrl\":\"hobby-shop\",\"name\":\"Hobby Shop\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":\"Hobby Shop\",\"driveCreativeFolderId\":null},{\"id\":8,\"communityUrl\":\"mechanical-keyboards\",\"name\":\"Mechanical Keyboards\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":\"Mech Keys\",\"driveCreativeFolderId\":null},{\"id\":11,\"communityUrl\":null,\"name\":\"Crowdfunded\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":12,\"communityUrl\":\"tech\",\"name\":\"Tech\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":\"Tech\",\"driveCreativeFolderId\":null},{\"id\":13,\"communityUrl\":null,\"name\":\"Vaping\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":true,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":14,\"communityUrl\":\"quilting\",\"name\":\"Quilting\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":\"Quilting\",\"driveCreativeFolderId\":null},{\"id\":15,\"communityUrl\":null,\"name\":\"Beauty\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":16,\"communityUrl\":null,\"name\":\"Paintball\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":17,\"communityUrl\":null,\"name\":\"3D Printing\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":18,\"communityUrl\":\"writing\",\"name\":\"Writing\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":\"Writing\",\"driveCreativeFolderId\":null},{\"id\":19,\"communityUrl\":null,\"name\":\"Food & Kitchen\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":20,\"communityUrl\":null,\"name\":\"Coffee\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":21,\"communityUrl\":null,\"name\":\"Tea\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":22,\"communityUrl\":\"pro-audio\",\"name\":\"Pro Audio\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":\"Pro Audio\",\"driveCreativeFolderId\":null},{\"id\":23,\"communityUrl\":null,\"name\":\"X\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":24,\"communityUrl\":\"ultralight\",\"name\":\"Ultralight\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":\"Ultralight\",\"driveCreativeFolderId\":null},{\"id\":25,\"communityUrl\":null,\"name\":\"Crafting\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":26,\"communityUrl\":null,\"name\":\"Men's Style (Old)\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":27,\"communityUrl\":null,\"name\":\"Massdrop\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":false,\"isNew\":false,\"isMature\":false,\"shortName\":null,\"driveCreativeFolderId\":null},{\"id\":31,\"communityUrl\":\"photography\",\"name\":\"Photography\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":true,\"isMature\":false,\"shortName\":\"Photography\",\"driveCreativeFolderId\":null},{\"id\":32,\"communityUrl\":\"corvette\",\"name\":\"Corvette\",\"isDropCategory\":false,\"isPollCategory\":false,\"isUpcoming\":true,\"isNew\":false,\"isMature\":false,\"shortName\":\"Corvette\",\"driveCreativeFolderId\":null},{\"id\":33,\"communityUrl\":\"rc-cars\",\"name\":\"RC Cars\",\"isDropCategory\":true,\"isPollCategory\":true,\"isUpcoming\":false,\"isNew\":true,\"isMature\":false,\"shortName\":\"RC Cars\",\"driveCreativeFolderId\":null}]},\"ApplicationStore\":{\"pageTitle\":\"Sign Up or Login\",\"pageStatusCode\":null,\"pageMeta\":{\"title\":\"Massdrop: Bringing Enthusiasts Together\"}},\"PollStore\":{\"polls\":{},\"currentPollId\":null},\"DropsStore\":{\"drop\":null,\"shippingRate\":[],\"activeDrops\":[],\"inactiveDrops\":[],\"endingDrops\":[],\"relatedDrops\":[],\"categoryDrops\":{\"activeDrops\":[],\"inactiveDrops\":[]},\"recentActivity\":[],\"dropOptions\":[]},\"StatsStore\":{\"previousUrl\":\"\\u002F\",\"uid\":null},\"RouteStore\":{\"currentUrl\":\"\\u002F\",\"currentNavigate\":{\"url\":\"\\u002F\"},\"currentNavigateError\":null,\"isNavigateComplete\":true,\"routes\":null}}},\"plugins\":{\"FetchrPlugin\":{\"xhrPath\":\"\\u002Fapi\",\"xhrTimeout\":200000,\"corsPath\":null},\"SessionPlugin\":{\"session\":{\"cookie\":{\"originalMaxAge\":null,\"expires\":null,\"httpOnly\":true,\"path\":\"\\u002F\"},\"currentVisitSession\":{\"landingPath\":\"\\u002F\",\"landingQuery\":{},\"userAgent\":\"Ruby\",\"ip\":\"67.246.71.33\",\"referralCode\":null,\"id\":59408950},\"save\":function save() {\n        debug('saving %s', this.id);\n        savedHash = hash(this);\n        _save.apply(this, arguments);\n      }}},\"ConfigPlugin\":{\"config\":{\"isBazaarActive\":false,\"bazaarMonth\":\"October\",\"algolia\":{\"id\":\"2VUYIRTEYW\",\"key\":\"20112246a0d23298c391abf3882ebeee\"},\"isInternalAnalyticsEnabled\":true,\"isAmplitudeEnabled\":true,\"isGoogleAnalyticsEnabled\":true,\"isSiftScienceEnabled\":true,\"isFacebookPixelsEnabled\":true,\"siftScienceJSKey\":\"0f3693420e\",\"siftScienceUseWhitelist\":true,\"facebookPixels\":{\"purchase\":\"6020966579340\",\"addToCart\":\"6020966592140\",\"signUp\":\"6015968551740\"},\"devMode\":false,\"assets\":{\"js\":[{\"src\":\"https:\\u002F\\u002Fcdn1.massdrop.com\\u002Fdist\\u002Fjs\\u002Fvendor-167f2e5bcd8a8e134f6f-compressed.js\"},{\"src\":\"https:\\u002F\\u002Fcdn1.massdrop.com\\u002Fdist\\u002Fjs\\u002Fclient-app-167f2e5bcd8a8e134f6f-compressed.js\"}],\"css\":[{\"href\":\"https:\\u002F\\u002Fcdn1.massdrop.com\\u002Fdist\\u002Fstylesheets\\u002Fmassdrop-09c483ae156a81cb37ced6f9c6a1b0cf-compressed.css\",\"media\":\"screen\"},{\"href\":\"https:\\u002F\\u002Fcdn1.massdrop.com\\u002Fdist\\u002Fstylesheets\\u002Fmassdrop_print-3f85d78b50bc2c5aa3a877b278cacc95-compressed.css\",\"media\":\"print\"}]},\"nodeEnv\":\"production\",\"rollbarClientToken\":\"0c49fe295d4f48c49e523e4ec07fc5b4\"}},\"UserAgentPlugin\":{\"userAgent\":{\"string\":\"Ruby\",\"isMobile\":false,\"isPhone\":false,\"isTablet\":false,\"isUnsupported\":false,\"isSocialCrawler\":false,\"browserType\":null,\"crawlerType\":null}}}},\"plugins\":{\"HttpHeadersPlugin\":{},\"GoogleAnalyticsPlugin\":{\"options\":{\"trackingId\":\"UA-29278272-11\"}},\"SiftSciencePlugin\":{\"options\":{\"apiKey\":\"0f3693420e\"}},\"FacebookPlugin\":{\"options\":{\"appId\":\"142386762546138\",\"cookie\":true,\"xfbml\":true,\"version\":\"v2.4\"}},\"FacebookPixelPlugin\":{},\"Amplitude\":{\"options\":{\"appKey\":\"c7b893b70c8f16635427c4202ca8a1e0\"}}}};</script><script src=\"https://cdn1.massdrop.com/dist/js/vendor-167f2e5bcd8a8e134f6f-compressed.js\" defer></script><script src=\"https://cdn1.massdrop.com/dist/js/client-app-167f2e5bcd8a8e134f6f-compressed.js\" defer></script></html>",
  "status": "success",
  "updated_at": "2015-11-16 16:22:33 +0000",
  "url": "massdrop.com"
}
```

If a request failed for whatever reason (request timeout, invalid URL, system error, etc.) the response `status` will be `failed` and an `error` property indicating the failure.

```
{
  "created_at": "2015-11-16 16:36:31 +0000",
  "error": "request_timeout",
  "id": "38726f2d-5442-4d9e-8627-d64375f89a75",
  "status": "failed",
  "updated_at": "2015-11-16 16:36:31 +0000",
  "url":"http://127.0.0.1:4000"
}
```
